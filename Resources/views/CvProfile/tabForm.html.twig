<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>

<ul class="nav nav-tabs" id="cvTab">
    <li><a href="#profile" data-toggle="tab">Profil</a></li>
    <li><a href="#studies" data-toggle="tab">Etudes</a></li>
    <li><a href="#experiences" data-toggle="tab">Expérience</a></li>
    <li><a href="#others" data-toggle="tab">Autres</a></li>
</ul>


<div class="tab-content">

    <div class="tab-pane active" id="profile">
        {{ form_errors(form) }}
            <div>
                <h2>Résumé</h2>
          {{ form_row(form.totalExperienceYears) }}
            </div>
            <div>
                <h2>Données personelles</h2>
          {{ form_row(form.cvPersonal.lastName) }}
          {{ form_row(form.cvPersonal.lastNamePrefix) }}
          {{ form_row(form.cvPersonal.initials) }}
          {{ form_row(form.cvPersonal.firstName) }}
          {{ form_row(form.cvPersonal.middleName) }}
          {{ form_row(form.cvPersonal.title) }}
          {{ form_row(form.cvPersonal.dateOfBirth) }}
          {{ form_row(form.cvPersonal.placeOfBirth) }}
          {{ form_row(form.cvPersonal.maritalStatus) }}
          {{ form_row(form.cvPersonal.nationality) }}
          {{ form_row(form.cvPersonal.genderCode) }}
          {{ form_row(form.cvPersonal.driversLicence) }}
          {{ form_row(form.cvPersonal.availability) }}
            </div>

            <div>
                <h2>Adresse</h2>
          {{ form_widget(form.cvPersonal.CvAddress) }}
            </div>

            <div>
                <h2>Coordonnées</h2>
          {{ form_widget(form.cvPersonal.CvAddress) }}
            </div>

            <div>
                {#form_rest(form) #}
            </div>



    </div>

    <div class="tab-pane" id="studies">
        <div id="studies_form">
            {{ form_errors(form.cvEducationHistories) }}
            {{ form_widget(form.cvEducationHistories) }}
        </div>
        <p>
            <button class="btn" id="addCvEducHistory" type="button">
                <i class="icon-plus"></i>
            </button>
        </p>
    </div>

    <div class="tab-pane" id="experiences">
        <div id="experiences_form">
            {{ form_errors(form.cvEmploymentHistories) }}
            {{ form_widget(form.cvEmploymentHistories) }}
        </div>
        <p>
            <button class="btn" id="addCvEmployHistory" type="button">
                <i class="icon-plus"></i>
            </button>
        </p>
    </div>

    <div class="tab-pane" id="others">
                        {{ form_rest(form)}}
    </div>

</div>

<script>
jQuery(function () {
    $('#cvTab a:first').tab('show');
    
    $("#addCvEducHistory").click(function () {
        addTagForm("#studies #studies_form","addCvEducHistory" );
    });
    
    $("#addCvEmployHistory").click(function () {
        addTagForm("#experiences #experiences_form","addCvEmployHistory" );
    });
    
});
      
function addTagForm(div, idLinkAdd) {
    var collectionHolder = $(div+" > div");dump($(div+" > div"));
    // Récupère l'élément ayant l'attribut data-prototype comme expliqué plus tôt
    var prototype = collectionHolder.attr('data-prototype');

    // Remplace '__name__' dans le HTML du prototype par un nombre basé sur
    // la longueur de la collection courante
    var newForm = prototype.replace(/__name__/g, $(div).parent().children().size());

    // Affiche le formulaire dans la page dans un div, avant le lien "ajouter"
    var $newFormLi = $('<div></div>').append(newForm);
    $("#"+idLinkAdd).parent().before($newFormLi);
}

</script>